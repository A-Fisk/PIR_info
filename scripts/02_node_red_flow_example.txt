Node Red Flows

All exported to clipboard

[{"id":"c5cad5fc.666c78","type":"tab","label":"Flow 1"},{"id":"a68018e6.844cf8","type":"tab","label":"Flow 2"},{"id":"c7f5607c.fb0ee","type":"serial-port","z":"c5cad5fc.666c78","serialport":"/dev/ttyACM0","serialbaud":"57600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":false},{"id":"c47cbfca.e1bf4","type":"serial-port","z":"c5cad5fc.666c78","serialport":"/dev/ttyACM1","serialbaud":"57600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":false},{"id":"1b5d33e.6ae27cc","type":"serial-port","z":"","serialport":"/dev/ttyACM2","serialbaud":"57600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":false},{"id":"4982f49d.de3c2c","type":"serial-port","z":"","serialport":"/dev/ttyACM3","serialbaud":"57600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":false},{"id":"15622988.a2ff86","type":"dropbox-config","z":""},{"id":"a7206c5d.a1d46","type":"timestamp","z":"c5cad5fc.666c78","name":"","x":430,"y":125,"wires":[["ca4f1d1b.456c6"]]},{"id":"5b12ed35.ca3fc4","type":"serial in","z":"c5cad5fc.666c78","name":"arduino_6A","serial":"c7f5607c.fb0ee","x":200,"y":133,"wires":[["a7206c5d.a1d46"]]},{"id":"8fe7b814.1cd338","type":"timestamp","z":"c5cad5fc.666c78","name":"starting timestamp for filename","x":499,"y":50,"wires":[["e2b98b3b.cda858"]]},{"id":"e2b98b3b.cda858","type":"function","z":"c5cad5fc.666c78","name":"datestring_6A","func":"\n\n// Create a Date object from the payload\nvar date = new Date(msg.timestamp);\n// Change the payload to be a formatted Date string\nmsg.payload = date.toISOString();\n\ncontext.global.set(\"fname1\", \"/home/pi/BSB_6A_\" + msg.payload + \".csv\");\nmsg.filename =context.global.get(\"fname1\");\n// Return the message so it can be sent on\nreturn msg;\n","outputs":"1","noerr":0,"x":776,"y":56,"wires":[["1fe9ae75.a43492","d484fb03.acade8"]]},{"id":"ca4f1d1b.456c6","type":"function","z":"c5cad5fc.666c78","name":"add timestamp to payload","func":"msg.payload =msg.timestamp +',' +msg.payload;\nmsg.filename =context.global.get(\"fname1\");\nreturn msg;","outputs":1,"noerr":0,"x":688,"y":138,"wires":[["1fe9ae75.a43492","d484fb03.acade8"]]},{"id":"1fe9ae75.a43492","type":"file","z":"c5cad5fc.666c78","name":"arduino1_log","filename":"","appendNewline":false,"createDir":false,"overwriteFile":"false","x":1102,"y":37,"wires":[]},{"id":"d484fb03.acade8","type":"debug","z":"c5cad5fc.666c78","name":"","active":true,"console":"false","complete":"payload","x":1077,"y":133,"wires":[]},{"id":"757a428a.bd486c","type":"inject","z":"c5cad5fc.666c78","name":"headers","topic":"","payload":"Time, Device, PIR1,PIR2,PIR3,PIR4,PIR5,PIR6,LDR, /r/n","payloadType":"string","repeat":"","crontab":"","once":true,"x":282,"y":50,"wires":[["8fe7b814.1cd338"]]},{"id":"1dcf8509.a2534b","type":"timestamp","z":"c5cad5fc.666c78","name":"starting timestamp for filename","x":465,"y":236,"wires":[["25a62f08.4ec47"]]},{"id":"25a62f08.4ec47","type":"function","z":"c5cad5fc.666c78","name":"datestring_6B","func":"\n\n// Create a Date object from the payload\nvar date = new Date(msg.timestamp);\n// Change the payload to be a formatted Date string\nmsg.payload = date.toISOString();\n\ncontext.global.set(\"fname2\", \"/home/pi/BSB_6B_\" + msg.payload + \".csv\");\nmsg.filename =context.global.get(\"fname2\");\n// Return the message so it can be sent on\nreturn msg;\n","outputs":"1","noerr":0,"x":742,"y":242,"wires":[["7b6c8429.9c27fc","2f051612.99913a"]]},{"id":"3f4e3575.88f29a","type":"function","z":"c5cad5fc.666c78","name":"add timestamp to payload","func":"msg.payload =msg.timestamp +',' +msg.payload;\nmsg.filename =context.global.get(\"fname2\");\nreturn msg;","outputs":1,"noerr":0,"x":654,"y":324,"wires":[["7b6c8429.9c27fc","2f051612.99913a"]]},{"id":"7b6c8429.9c27fc","type":"file","z":"c5cad5fc.666c78","name":"arduino2_log","filename":"","appendNewline":false,"createDir":false,"overwriteFile":"false","x":1068,"y":223,"wires":[]},{"id":"2f051612.99913a","type":"debug","z":"c5cad5fc.666c78","name":"","active":true,"console":"false","complete":"payload","x":1043,"y":319,"wires":[]},{"id":"2e5b94f6.efaedc","type":"inject","z":"c5cad5fc.666c78","name":"headers","topic":"","payload":"Time, Device, PIR1,PIR2,PIR3,PIR4,PIR5,PIR6,LDR, /r/n","payloadType":"str","repeat":"","crontab":"","once":true,"x":248,"y":236,"wires":[["1dcf8509.a2534b"]]},{"id":"6e658dd5.ca3e04","type":"timestamp","z":"c5cad5fc.666c78","name":"","x":396,"y":311,"wires":[["3f4e3575.88f29a"]]},{"id":"9c192140.2856b","type":"serial in","z":"c5cad5fc.666c78","name":"arduino_6B","serial":"c47cbfca.e1bf4","x":175,"y":330,"wires":[["6e658dd5.ca3e04"]]},{"id":"b71e0ffd.e7cc8","type":"watch","z":"a68018e6.844cf8","name":"pi_home","files":"/home/pi/","x":134,"y":176.99998474121094,"wires":[["8f577267.2c877"]]},{"id":"1679dfd2.84342","type":"delay","z":"a68018e6.844cf8","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"6","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":656,"y":326,"wires":[["2745b1d6.b6a27e"]]},{"id":"4ef1f3ea.4821ac","type":"debug","z":"a68018e6.844cf8","name":"","active":true,"console":"false","complete":"true","x":1072,"y":464,"wires":[]},{"id":"2745b1d6.b6a27e","type":"change","z":"a68018e6.844cf8","name":"","rules":[{"t":"set","p":"localFilename","to":"msg.payload"},{"t":"delete","p":"payload"},{"t":"set","p":"filename","to":"msg.file"}],"action":"","property":"","from":"","to":"","reg":false,"x":855,"y":332,"wires":[["4ef1f3ea.4821ac"]]},{"id":"af97064.fc28ff8","type":"delay","z":"a68018e6.844cf8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"6","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":456,"y":330,"wires":[["1679dfd2.84342"]]},{"id":"8f577267.2c877","type":"switch","z":"a68018e6.844cf8","name":"check filename","property":"file","propertyType":"msg","rules":[{"t":"cont","v":"6A","vt":"str"},{"t":"cont","v":"6B","vt":"str"},{"t":"cont","v":"6C","vt":"str"},{"t":"cont","v":"6D","vt":"str"},{"t":"else"}],"checkall":"true","outputs":5,"x":311,"y":204.99998474121094,"wires":[["21efe59d.8ef70a"],["cb219f84.5a431"],["1aeee4b5.a7334b"],["3cc950fd.ad002"],["af97064.fc28ff8"]]},{"id":"6c9be9f0.8479a8","type":"change","z":"a68018e6.844cf8","name":"","rules":[{"t":"set","p":"localFilename","pt":"msg","to":"payload","tot":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"filename","pt":"msg","to":"file","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":781,"y":148,"wires":[["4ef1f3ea.4821ac","ff6415f0.83c198"]]},{"id":"21efe59d.8ef70a","type":"delay","z":"a68018e6.844cf8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"6","nbRateUnits":"","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":498,"y":137,"wires":[["6c9be9f0.8479a8"]]},{"id":"4468276b.e3dac8","type":"watch","z":"a68018e6.844cf8","name":"","files":"/home/pi/COMPASS_BACKUPS","x":191,"y":438,"wires":[["bada55b7.26f928"]]},{"id":"bada55b7.26f928","type":"switch","z":"a68018e6.844cf8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"backup","vt":"str"}],"checkall":"true","outputs":1,"x":448,"y":448,"wires":[["32c4d77f.bc92a8"]]},{"id":"32c4d77f.bc92a8","type":"change","z":"a68018e6.844cf8","name":"","rules":[{"t":"set","p":"localFilename","pt":"msg","to":"payload","tot":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"filename","pt":"msg","to":"file","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":761,"y":455,"wires":[["4ef1f3ea.4821ac"]]},{"id":"e9bc9569.49b538","type":"delay","z":"a68018e6.844cf8","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"6","nbRateUnits":"","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":644,"y":197,"wires":[["2948b86a.4bff28"]]},{"id":"2948b86a.4bff28","type":"change","z":"a68018e6.844cf8","name":"","rules":[{"t":"set","p":"localFilename","pt":"msg","to":"payload","tot":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"filename","pt":"msg","to":"file","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":197,"wires":[["4ef1f3ea.4821ac"]]},{"id":"e7585cd8.2c105","type":"delay","z":"a68018e6.844cf8","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"6","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":646,"y":238,"wires":[["69c3c206.0fcd2c"]]},{"id":"69c3c206.0fcd2c","type":"change","z":"a68018e6.844cf8","name":"","rules":[{"t":"set","p":"localFilename","to":"msg.payload"},{"t":"delete","p":"payload"},{"t":"set","p":"filename","to":"msg.file"}],"action":"","property":"","from":"","to":"","reg":false,"x":833,"y":240,"wires":[["4ef1f3ea.4821ac"]]},{"id":"4d732227.cf7ebc","type":"delay","z":"a68018e6.844cf8","name":"","pauseType":"delay","timeout":"7","timeoutUnits":"seconds","rate":"6","nbRateUnits":"","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":650,"y":281,"wires":[["95fc872.0475b78"]]},{"id":"95fc872.0475b78","type":"change","z":"a68018e6.844cf8","name":"","rules":[{"t":"set","p":"localFilename","pt":"msg","to":"payload","tot":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"filename","pt":"msg","to":"file","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":839,"y":285,"wires":[["4ef1f3ea.4821ac"]]},{"id":"3cc950fd.ad002","type":"delay","z":"a68018e6.844cf8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"6","nbRateUnits":"","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":495,"y":283,"wires":[["4d732227.cf7ebc"]]},{"id":"1aeee4b5.a7334b","type":"delay","z":"a68018e6.844cf8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"6","nbRateUnits":"","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":496,"y":236,"wires":[["e7585cd8.2c105"]]},{"id":"cb219f84.5a431","type":"delay","z":"a68018e6.844cf8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"6","nbRateUnits":"","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":498,"y":194,"wires":[["e9bc9569.49b538"]]},{"id":"ef50c54c.2153e8","type":"timestamp","z":"c5cad5fc.666c78","name":"starting timestamp for filename","x":474,"y":442,"wires":[["b0532606.c0e5f8"]]},{"id":"b0532606.c0e5f8","type":"function","z":"c5cad5fc.666c78","name":"datestring_6C","func":"\n\n// Create a Date object from the payload\nvar date = new Date(msg.timestamp);\n// Change the payload to be a formatted Date string\nmsg.payload = date.toISOString();\n\ncontext.global.set(\"fname3\", \"/home/pi/BSB_6C_\" + msg.payload + \".csv\");\nmsg.filename =context.global.get(\"fname3\");\n// Return the message so it can be sent on\nreturn msg;\n","outputs":"1","noerr":0,"x":751,"y":448,"wires":[["908bbd9a.9252c","880d41e8.8cdbc"]]},{"id":"f76cd89d.100398","type":"function","z":"c5cad5fc.666c78","name":"add timestamp to payload","func":"msg.payload =msg.timestamp +',' +msg.payload;\nmsg.filename =context.global.get(\"fname3\");\nreturn msg;","outputs":1,"noerr":0,"x":663,"y":530,"wires":[["908bbd9a.9252c","880d41e8.8cdbc"]]},{"id":"908bbd9a.9252c","type":"file","z":"c5cad5fc.666c78","name":"arduino3_log","filename":"","appendNewline":false,"createDir":false,"overwriteFile":"false","x":1077,"y":429,"wires":[]},{"id":"880d41e8.8cdbc","type":"debug","z":"c5cad5fc.666c78","name":"","active":true,"console":"false","complete":"payload","x":1052,"y":525,"wires":[]},{"id":"f595940c.d5e158","type":"inject","z":"c5cad5fc.666c78","name":"headers","topic":"","payload":"Time, Device, PIR1,PIR2,PIR3,PIR4,PIR5,PIR6,LDR, /r/n","payloadType":"str","repeat":"","crontab":"","once":true,"x":257,"y":442,"wires":[["ef50c54c.2153e8"]]},{"id":"5ed13665.ecb468","type":"timestamp","z":"c5cad5fc.666c78","name":"","x":405,"y":517,"wires":[["f76cd89d.100398"]]},{"id":"35d2c0d9.d7b4f","type":"serial in","z":"c5cad5fc.666c78","name":"arduino_6C","serial":"4982f49d.de3c2c","x":184,"y":536,"wires":[["5ed13665.ecb468"]]},{"id":"1b21cb9e.18be94","type":"timestamp","z":"c5cad5fc.666c78","name":"starting timestamp for filename","x":482,"y":649,"wires":[["913ffe7.de454"]]},{"id":"913ffe7.de454","type":"function","z":"c5cad5fc.666c78","name":"datestring_6D","func":"\n\n// Create a Date object from the payload\nvar date = new Date(msg.timestamp);\n// Change the payload to be a formatted Date string\nmsg.payload = date.toISOString();\n\ncontext.global.set(\"fname4\", \"/home/pi/BSB_6D_\" + msg.payload + \".csv\");\nmsg.filename =context.global.get(\"fname4\");\n// Return the message so it can be sent on\nreturn msg;\n","outputs":"1","noerr":0,"x":759,"y":655,"wires":[["8934a789.74dfc8","f7db57b4.af61a8"]]},{"id":"c3ac206f.21d88","type":"function","z":"c5cad5fc.666c78","name":"add timestamp to payload","func":"msg.payload =msg.timestamp +',' +msg.payload;\nmsg.filename =context.global.get(\"fname4\");\nreturn msg;","outputs":1,"noerr":0,"x":671,"y":737,"wires":[["8934a789.74dfc8","f7db57b4.af61a8"]]},{"id":"8934a789.74dfc8","type":"file","z":"c5cad5fc.666c78","name":"arduino4_log","filename":"","appendNewline":false,"createDir":false,"overwriteFile":"false","x":1085,"y":636,"wires":[]},{"id":"f7db57b4.af61a8","type":"debug","z":"c5cad5fc.666c78","name":"","active":true,"console":"false","complete":"payload","x":1060,"y":732,"wires":[]},{"id":"4b4b99ca.824d28","type":"inject","z":"c5cad5fc.666c78","name":"headers","topic":"","payload":"Time, Device, PIR1,PIR2,PIR3,PIR4,PIR5,PIR6,LDR, /r/n","payloadType":"str","repeat":"","crontab":"","once":true,"x":265,"y":649,"wires":[["1b21cb9e.18be94"]]},{"id":"47d3756a.15480c","type":"timestamp","z":"c5cad5fc.666c78","name":"","x":413,"y":724,"wires":[["c3ac206f.21d88"]]},{"id":"21b055d2.cb18da","type":"serial in","z":"c5cad5fc.666c78","name":"arduino_6D","serial":"1b5d33e.6ae27cc","x":192,"y":743,"wires":[["47d3756a.15480c"]]},{"id":"ff6415f0.83c198","type":"dropbox","z":"a68018e6.844cf8","dropbox":"15622988.a2ff86","filename":"","name":"Compass_Noderedv2","x":1164.5,"y":70,"wires":[[]]},{"id":"39935d9.fb73fa2","type":"dropbox","z":"a68018e6.844cf8","filename":"","name":"","x":1217.5,"y":167,"wires":[[]]},{"id":"df62f41b.dc0968","type":"dropbox","z":"a68018e6.844cf8","filename":"","name":"","x":1212.5,"y":238,"wires":[[]]},{"id":"b4257f4a.5475f","type":"dropbox","z":"a68018e6.844cf8","filename":"","name":"","x":1211.5,"y":342,"wires":[[]]},{"id":"9921086d.4ab0d8","type":"dropbox out","z":"a68018e6.844cf8","filename":"","localFilename":"","name":"","x":1352.5,"y":456,"wires":[]}]

